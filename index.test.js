
const process = require('process');
const cp = require('child_process');
const path = require('path');

// shows how the runner will run a javascript action with env / stdout protocol
test('test runs', () => {
  const testString = 'TEST';
  
  process.env['INPUT_PATH'] = "./test.txt";  
  process.env['INPUT_CONTENT'] = `ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibHVjYS0yMzA2
  MTYiLAogICJwcml2YXRlX2tleV9pZCI6ICI0OTdkMGExMTBhNTRkNjdiNTY0Yzk1NGU1NzgzOGE4
  MmJlMWU5NWU1IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0t
  XG5NSUlFdkFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLWXdnZ1NpQWdFQUFvSUJBUUN4Q0w2
  T052Z2RZM3h2XG5zTWM5M1dyamN1ekV0Mk9tU0tsOU9NWmhIb0U3Mm1GdUZWTlh2cVMvL0c5eDda
  UmhZM2Y0djh6VTczWVQydlhKXG5CUHlvcndhRmIwUHhua3laN2t0VXhWV3lQT0xKL0xSSGxLOTVl
  QTVhQWpJMnBmSzNxbGl0b2NQSkxiT25rd1JoXG5ROXJjVVdtem00bVAwaUNkTEFrVnJIYk0vaGhy
  WjFPTmNlN2haTWx2cUkrUlpyMDQxeldKZ0VtcURQTDAwOHZWXG5UMExUSE5tWTR6RTAyN2tscnNX
  clVscGFCUE1yb2t6dVNtUzZkTW9KVzNNNEZEQVZQdjNxZVVPcDN6UDB5QkN3XG5VOXc3QURza2s2
  ak9taDkxSGxicHRVb1ZianVjS3h0c3dUeFc5WEl6RVhLeFN6a3hKWWgxZFZSTUhjRUtWMU9VXG54
  bXJkczlTZEFnTUJBQUVDZ2dFQUE0by91VHRMS2RkSDhUblJPaUQzMXJXQkc0dnBQN1Y3UWloRSsw
  TXZaV0dBXG5Da0g5NlNiRVI1eUdJL3FTdVlIU0w5U3lCVjRHZCs0c2RRa1cvazZGckZ4bHVPcW44
  SG9ONHBPUm01OVJENlh3XG5ldS96dEZPY3dkc0NZd3BkZUtPODR6ZjFZTXY3cURHdDZENEJuZDg0
  NUdFTFZxZG1oSTRSWG5BVTdoTjBySTBiXG5YWkREem5qS25Mdy80c1lTbTBlbk43b0I2bllKbXl3
  RXlvTmkyTTUwdEhGY0RYVFpvZktLNHZYbFNDd05PM3hyXG45alkrTnRwdzd4OHBvODFKS2NveVgx
  QWZ6SjN4N2RlU0FjUkc2eG85ZFFvckhCTDNzOWRtTU1JT3NVYVdJYzhmXG5hcUg4S2NyQytsS25y
  U3YyaTBWWjhrUWtpdTZBdEo0SHZLQ3MrZ1FHQVFLQmdRRGdRYUxKam8rak9jVWJ0QVJjXG5qZ2hT
  NFBla0RFajNXS3dWQzlEQmhRRTI0WExNWjhVajgrSU04dTZBdEZYQnMyTXptRjR0TlFmSDcvY09Y
  ZnVEXG4waldPSmo2Tnhxd2x1Vk9COWx0T2JJNnRubDAzditJb0hzMmZEblRRdW5RNTl4cnI1S3Jz
  M2QvWWhRS2ZCTTUzXG4wZ21CaitHVlY2V21OUDJDdVBoNXhoWnBBUUtCZ1FES0YrdGw3OFgrV3RY
  ek9iRnJES0FaeE9tYnFPaksxSlhsXG5YdVlRdjZSZ0JxT1RPMGd1MzRadUFBYlJodk14SzFrWEVD
  VDZwdjZ0L2FKZGI0elAvc3FBOUhyMUNOcDFINFZqXG5BRDFnZ29WZVpES3piWElzZ2lhRWN5NmNE
  OC9VY1ZnNVdMd3l6UC8yUWMrSS9QRThsclNsbDRUdjM5bnlMWm5SXG41dlRMakc1dm5RS0JnQWpk
  cjNEbWlQazhESFhtN1JFM3NFNk9oRnZnL0hXQzlQSzBEK0hHdjJDTEV6M1BrSFMyXG5iS1owYUVl
  QVdhK1p4djlBTStEM3FzSVYwNStteVkzUm5ycHErcWdpUmFZTUtLZ0h0RjVxWGsydzZDQ1BIb0xW
  XG5qTzJQNWNCbXpyZUg5SEdGRGRqbGdMY1BzeVhVUzlGaTVXdFE0K3RDbHRMMlgxdHVzcXdsejdj
  QkFvR0FVU2ZWXG40ak90b1AwOVdkVmJTQS9qNHpWT1VySTcrZWZ3NGhGLzlrM2ZacWlEMjhZOHNJ
  WVc1K21lMDFtTUk3eXlwQzVaXG5pMGF3azVKOU4yUnFlY1JwOGVzN3pWYm0wNDM2OU16TjJRblJJ
  UnkvdDRwR0JWV212aDI3SS9TOWt5U0pOMDVKXG5GV1Y1akp6VkNMLzY2RWZrOTNLbmNlVEZFeG40
  NFhBTDhnbk05NGtDZ1lBdjB3UFZkVk5hVGZBRGRPdTFzam91XG42V3c1TCtQazR3akMyUVRxWjJp
  VDFUMDNqa2JpcnRkWTZDMFB0NkttZ3F2SkZDRW1KNDlVM3BrR0xiQUdHRHVoXG44T0lFaFlpMWZ2
  T200K3l4NEphVWNEUFVRTC9JVU5qSVcvUGlxSEd4SEg0YklRNEtuLzVDUmo3SWNEOHJsc1I3XG5V
  NzNIeGRjMkZwNmpXVktzVDl5Q3J3PT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAg
  ImNsaWVudF9lbWFpbCI6ICJwdWJzdWItcHJvZEBsdWNhLTIzMDYxNi5pYW0uZ3NlcnZpY2VhY2Nv
  dW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMDcwMzkzNTQ5Nzg0MDI1MzQwMjYiLAogICJhdXRo
  X3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRv
  a2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhf
  cHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0
  aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29n
  bGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L3B1YnN1Yi1wcm9kJTQwbHVjYS0yMzA2
  MTYuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iCn0=`;
  
  const ip = path.join(__dirname, 'index.js');
  const result = cp.execSync(`node ${ip}`, {env: process.env}).toString();
  console.log(result);

  // verify
  let decodedSecret = cp.execSync(`cat ${process.env['INPUT_PATH']}`).toString();
  expect(decodedSecret).toBe(testString);

  // cleanup
  cp.execSync(`rm ${process.env['INPUT_PATH']}`).toString();
})
